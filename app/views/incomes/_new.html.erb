<!-- Modal -->
<div class="modal fade" id="addIncomes" role="dialog" aria-labelledby="addIncomesLabel">
  <div class="modal-dialog modal-sm" role="document" style="width: 400px;">
    <div class="modal-content">
      <%= form_for @income, html: {class: 'form-horizontal'} do |f| %>
      <% income = f.object  %>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addIncomesLabel"> 收入记录 <small>新建</small></h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <%= label_tag :reason, '收入类型', class: 'control-label col-sm-3' %>
          <div class="col-sm-9">
            <label for="reason_order" style="margin: 0px 5px;"><%= radio_button_tag :reason, 'order', params[:reason].blank? ? true : false, id: 'reason_order' %>订单收入</label>
            <label for="reason_other" style="margin: 0px 5px;"><%= radio_button_tag :reason, 'other', false, id: 'reason_other' %>其他收入</label>
          </div>
        </div>
        <div class="form-group">
          <label for="income_order_id" class="control-label col-sm-3" data-toggle="tooltip" title="收入来源（订单收入或者其他收入）"><span class="require">*</span>来源/订单号</label>
          <div class="col-sm-9">
            <!-- <select name="income[order_id]" class="remoteDataOrder form-control" required="required" style="width: 100%;">
            </select> -->
            <div class="input-group">
              <%= select_year Date.today.year, {field_name: :year, start_year: 2010, end_year: Date.today.year}, {class: 'form-control', style: 'width: 70px; padding-right: 3px;'} %>
              <div class="input-group-addon" style="padding: 6px 2px;">年</div>
              <%= select_month Date.today.month, {field_name: :month, use_month_numbers: true}, {class: 'form-control', style: 'width: 50px; padding-right: 3px;'} %>
              <div class="input-group-addon" style="padding: 6px 2px;">月</div>
              <%= text_field_tag :order_name, params[:order_name].presence, class:'form-control', placeholder: '请输入子订单号', data: {toggle: 'tooltip'}, title: '请输入需要查找的子订单号' %>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="income_bank_id" class="control-label col-sm-3"><span class="require">*</span>银行卡</label>
          <div class="col-sm-9">
            <%= select_tag 'income[bank_id]', options_for_select(Bank.all.map{|i|[i.bank_card, i.id]}), class: 'form-control', required: true %>
          </div>
        </div>
        <div class="form-group">
          <%= f.label '应收', class: 'control-label col-sm-3' %>
          <div class="col-sm-9">
            <%= f.number_field :should, min: 0, step: 0.01, class: 'form-control', disabled: true %>
          </div>
        </div>
        <div class="form-group">
          <%= f.label '已收', class: 'control-label col-sm-3' %>
          <div class="col-sm-9">
            <%= f.number_field :yet, min: 0, step: 0.01, class: 'form-control', disabled: true %>
          </div>
        </div>
        <div class="form-group">
          <label for="income_money" class="control-label col-sm-3"><span class="require">*</span>金额</label>
          <div class="col-sm-9">
            <%= f.number_field :money, value: 0, min: 0, step: 0.01, class: 'form-control', required: true %>
          </div>
        </div>
        <div class="form-group">
          <label for="income_username" class="control-label col-sm-3"><span class="require">*</span>经手人</label>
          <div class="col-sm-9">
            <%= f.text_field :username, value: current_user.username.presence || current_user.email, class: 'form-control col-sm-9', required: true %>
          </div>
        </div>
        <div class="form-group">
          <label for="income_income_at" class="control-label col-sm-3"><span class="require">*</span>时间</label>
          <div class="col-sm-9">
            <%= f.date_field :income_at, vaue: income.income_at.nil? ? '' : income.income_at.strftime("%Y-%m-%d"), class: 'form-control col-sm-9', data: {provide: 'datepicker'}, required: true %>
          </div>
        </div>
        <div class="form-group">
          <%= f.label '备注', for: 'income_note', class: 'control-label col-sm-3' %>
          <div class="col-sm-9">
            <%= f.text_field :note, class: 'form-control col-sm-9' %>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <%= f.button '取消', class: 'btn btn-default', data: {dismiss: 'modal'} %>
        <%= f.submit '提交', class: 'btn btn-primary' %>
      </div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
$(".remoteDataOrder").select2({
  language: 'zh-CN',
  theme: 'bootstrap',
  placeholder: "来源/订单号",
  minimumInputLength: 0,
  // width: '100%',
  ajax: {
    url: '/orders.json',
    dataType: 'json',
    delay: 250,
    cache: false,
    data: function(params){
      return {
        term: params.term,
        page: params.page || 1
      };
    },
    processResults: function(data, params){
      params.page = params.page || 1;
      return {
        results: data.orders,
        pagination: {
          more: (params.page * 6) < data.total
        }
      };
    }
  }
});
</script>
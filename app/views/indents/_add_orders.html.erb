<!-- Modal -->
<div class="modal fade" id="addOrders" tabindex="-1" role="dialog" aria-labelledby="addOrdersLabel">
  <div class="modal-dialog" role="document" style="width: 80%;">
    <div class="modal-content">
      <%= nested_form_for @indent, html: {class: 'form-horizontal', multipart: true} do |f| %>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="addOrdersLabel"> 子订单 <small>新建</small></h4>
      </div>
      <div class="modal-body">
        <div id="indentOrders">
          <%= f.fields_for :orders do |order_form| %>
          <div class="row" id="order-fields">
            <div class="col-sm-1 text-center indent-orders-title">
              <p>子订单</p>
              <p>
                <% of = order_form.object %>
                <%= order_form.object.name unless of.new_record?%>
                <!-- 初始下拉框默认选中项 -->
                <% init_ply_id = MaterialCategory.find_by(name: '18mm').id %>
                <% init_texture_id = MaterialCategory.find_by(name: '颗粒板').id %>
                <% init_color_id = MaterialCategory.find_by(name: '国色天香').id %>
                <% init_price = Material.find_by(ply: init_ply_id, texture: init_texture_id, color: init_color_id).try(:price) %>
              </p>
            </div>
            <div class="col-sm-10">
              <div class="row">
                <div class="col-sm-2">
                  <label>类型</label>
                  <%= order_form.select :order_category_id, OrderCategory.all.map{|oc| [oc.name, oc.id]}, class: 'form-control', required: true %>
                </div>
                <div class="col-sm-2">
                  <label>数量</label>
                  <%= order_form.number_field :number, min: 0, step: 0.01, style: "width: 50%;", required: true, readOnly: true, data: {toggle: 'tooltip'}, title: '数量不可编辑' %>
                </div>
                <div class="col-sm-2">
                  <label>厚度</label>
                  <%= order_form.collection_select :ply, MaterialCategory.where(oftype:MaterialCategory.oftypes[:ply]), :id, :name, { selected: init_ply_id }, {class: 'material-ply', onchange: 'getMaterialPrice(this)'} %>
                </div>
                <div class="col-sm-2">
                  <label>材质</label>
                  <%= order_form.collection_select :texture, MaterialCategory.where(oftype:MaterialCategory.oftypes[:texture]), :id, :name, { seleted: init_texture_id }, {class: 'material-texture', onchange: 'getMaterialPrice(this)'} %>
                </div>
                <div class="col-sm-2">
                  <label>颜色</label>
                  <%= order_form.collection_select :color, MaterialCategory.where(oftype:MaterialCategory.oftypes[:color]), :id, :name, { selected: init_color_id }, {class: 'material-color', onchange: 'getMaterialPrice(this)'} %>
                </div>
              </div>
              <div class="row">
                <!-- <div class="col-sm-2">
                  <label>长度</label>
                  <%#= order_form.number_field :length, min: 0, step: 0.01, style: "width: 50%;", required: true %>
                </div>
                <div class="col-sm-2">
                  <label>宽度</label>
                  <%#= order_form.number_field :width, min: 0, step: 0.01, style: "width: 50%;", required: true %>
                </div>
                <div class="col-sm-2">
                  <label>高度</label>
                  <%#= order_form.number_field :height, min: 0, step: 0.01, style: "width: 50%;", required: true %>
                </div> -->
                <div class="col-sm-2">
                  <label>价格</label>
                  <%= order_form.number_field :price, min: 0, step: 0.01, value: of.new_record? ? init_price : of.price, style: 'width: 50%;', class: 'material-price' %>
                </div>
                <div class="col-sm-5">
                  <label>备注</label>
                  <%= order_form.text_field :note, style: "width: 51%;" %>
                </div>
                <div class="col-sm-5">
                  <label>收货地址</label>
                  <%= order_form.text_field :delivery_address, style: "width: 61%;" %>
                </div>
              </div>
            </div>
            <div class="col-sm-1 text-center indent-orders-delete">
              <%= order_form.link_to_remove '删除', class: 'btn btn-info btn-lg' %>
            </div>
          </div>
          <hr style="margin: 10px 0;" />
          <% end %>
        </div>
      </div>
      <div class="modal-footer">
        <div class="pull-left">
          <%= f.link_to_add '添加子订单', :orders, class: 'btn btn-info', data: {target: '#indentOrders'} %>
        </div>
        <%= f.button '取消', class: 'btn btn-default', data: {dismiss: 'modal'} %>
        <%= f.submit '提交', class: 'btn btn-primary' %>
      </div>
      <% end %>
    </div>
  </div>
</div>